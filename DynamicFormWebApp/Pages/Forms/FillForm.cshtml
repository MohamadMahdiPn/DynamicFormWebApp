@page
@using DynamicFormWebApp.Domain.Enums

@model DynamicFormWebApp.Pages.Forms.FillFormModel
@{
    ViewData["Title"] = Model.Form?.Title ?? "Fill Form";
}

@if (Model.Form == null)
{
    <div class="alert alert-danger">Form not found.</div>
}
else
{
    <h2 class="mb-3">@Model.Form.Title</h2>

    @if (!string.IsNullOrWhiteSpace(Model.Form.Description))
    {
        <p class="text-muted">@Model.Form.Description</p>
    }

    <form method="post" novalidate>
        <input type="hidden" name="id" value="@Model.Form.Id" />

        @foreach (var field in Model.Form.Fields.OrderBy(f => f.Order))
        {
            var fieldName = $"SubmittedValues[{field.Name}]";
            var fieldValue = Model.SubmittedValues.ContainsKey(field.Name)
                ? Model.SubmittedValues[field.Name]
                : string.Empty;

            <div class="mb-3">
                <label class="form-label fw-bold">
                    @field.Label
                    @if (field.IsRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>

                @switch (field.Type)
                {
                    case FieldType.Text:
                        <input type="text" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.Number:
                        <input type="number" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.Email:
                        <input type="email" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.Password:
                        <input type="password" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.Date:
                        <input type="date" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.Time:
                        <input type="time" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.DateTime:
                        <input type="datetime-local" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;

                    case FieldType.TextArea:
                        <textarea class="form-control" name="@fieldName">@fieldValue</textarea>
                        break;

                    case FieldType.Select:
                        var options = string.IsNullOrWhiteSpace(field.OptionsJson)
                            ? new List<string>()
                            : System.Text.Json.JsonSerializer.Deserialize<List<string>>(field.OptionsJson)!;

                        <select class="form-select" name="@fieldName">
                            <option value="">-- Select --</option>
                            @foreach (var opt in options)
                            {
                                <option value="@opt" selected="@(fieldValue == opt)">@opt</option>
                            }
                        </select>
                        break;

                    case FieldType.Radio:
                        var radioOptions = string.IsNullOrWhiteSpace(field.OptionsJson)
                            ? new List<string>()
                            : System.Text.Json.JsonSerializer.Deserialize<List<string>>(field.OptionsJson)!;
                        foreach (var opt in radioOptions)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="@fieldName" id="@($"{field.Name}_{opt}")" value="@opt" checked="@(fieldValue == opt)" />
                                <label class="form-check-label" for="@($"{field.Name}_{opt}")">@opt</label>
                            </div>
                        }
                        break;

                    case FieldType.Checkbox:
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="@fieldName" value="true" checked="@(fieldValue == "true")" />
                            <label class="form-check-label">@field.Label</label>
                        </div>
                        break;

                    default:
                        <input type="text" class="form-control" name="@fieldName" value="@fieldValue" />
                        break;
                }

                <span class="text-danger">
                    @Html.ValidationMessage($"SubmittedValues[{field.Name}]")
                </span>
            </div>
        }

        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Submit</button>
            <a asp-page="/Forms/List" class="btn btn-secondary">Back to List</a>
        </div>
    </form>
}
